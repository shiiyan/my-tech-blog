# イミュータブルデータモデリング　第４章第５章　読書感想文

## 第4章 イミュータブルデータモデルの実践

### 業務フロー（ワークフロー）を表現

一連のイベントの最新状態を表現するためには

ステータス

ロングタームイベントパターン

問い合わせの状況を一覧化のために

詳細なイベントのスーパータイプ「問い合わせアクティビティ」

「問い合わせ受付」エンティティ
進行状況に応じて更新する必要がある。

ポインターと理解すれば、違和感ない。

vs. イベントソーシングパターン

> 識別子（主キー）をエンティティのタイトルにしているのは初めてみる

### 過去や未来のデータを扱う

シングル世代テーブルパターン

適用開始日
適用終了日

レンジスキャン

有効世代ビューパターン

「現在商品価格」エンティティ

有効＝現在

RDBMSではビューを使って実装。

> ビューを実行する時に、結局、クエリのJOINになるので、パフォーマンス大丈夫？

世代バージョンタグ付けパターン

> バージョンを主キーにして、現在商品価格を表現する方法だ。
> クエリ時に必ずバージョン必要

### サブタイプを実装する

> 『RDBアンチパターン』にも登場する内容だ

> 3つの中、クラステーブル継承パターンが一番良さそう。

### 第4章感想

> 第４章は実装時の解決パターンを紹介している。
> モデリングを実装へ落としていく中、パフォーマンス問題や複雑なユースケースに出会った時に有効な内容だ。
> これからモデリングする人は第3章までの内容で十分。

## 第5章 ドメインモデルへの応用

> ドメインモデルの話来た
> ドメインモデルと普通のデータモデルと何が違うだろう

ドメイン層と永続化層は別、
ユーザーは永続化層に関心がない

複雑さ
シンプル化のルール

データの塊

一度に見るべきの範囲を狭める

ビジネスルールが存在します

ドメインモデルとしては及第点

Order
->
InProgressOrder, DeliveringOrder, CloseOrder

public interface Deliverable

InProgressOrder implements Order, Deliverable

DeliveringOrder implements Order, OrderClosable

> interfaceめっちゃ細かく作っている
> interfaceによってビジネスルールを表現している感じ

1つのクラスが1つの概念（ルール）

ドメインモデルの存在意義

ドランザクションスクリプトは悪なのか

複雑さのない、シンプルなデータのみを扱う

コンポーザビリティ

> 初めて聞く単語

抽選販売が追加された

LotteryOrder implements Order, Winnable

WinningOrder implements Order, Deliverable

### 第5章感想

> 注文の例、わかりやすかった。複雑さをシンプルにするよりも、1つのクラスが1つの概念（ルール）方が現実に近い
> 最後に言ったサブドメイン分割はどういう意味？Orderを分解することを言っているのか

#reading
